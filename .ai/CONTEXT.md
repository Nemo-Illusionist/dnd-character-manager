# Контекст для AI-ассистента

## О проекте

Это PWA для управления TTRPG персонажами и ресурсами. Разрабатывается одним человеком с помощью AI (Claude). **90% кода сгенерировано AI**.

## Как работать с проектом

### Общие принципы
1. **Код на английском**, документация в `.ai/` на русском
2. **Термины D&D** — строго по SRD 5.2.1 (официальные названия)
3. **Mobile-first** — UI должен работать на телефонах
4. **Простота** — не переусложнять, это MVP

### Структура изменений

При работе с **листом персонажа D&D**:
- Компоненты в `frontend/src/components/game-systems/dnd/dnd2024/`
- Core логика (abilities, skills) в `frontend/src/components/game-systems/dnd/core/`
- Типы персонажа в `shared/src/types.ts`

При работе с **игровыми системами**:
- Новая система = новая папка в `game-systems/`
- Расширить тип `GameSystem` в shared types
- Следовать паттерну D&D (core + version-specific)

При работе с **Firebase**:
- Сервисы в `frontend/src/services/`
- Правила в `firestore.rules`
- После изменения rules: `npm run setup:rules`

### Частые задачи

**Добавить поле в лист персонажа:**
1. Добавить в тип `DnD2024CharacterData` в `shared/src/types.ts`
2. Добавить UI в соответствующий компонент в `dnd2024/`
3. Обновить сервис если нужна специальная логика

**Добавить новую страницу:**
1. Создать компонент в `pages/`
2. Добавить роут в `App.tsx` или соответствующий layout
3. Добавить навигацию если нужно

**Добавить shared компонент:**
1. Создать в `components/shared/`
2. Экспортировать из `index.ts` если есть

## Текущее состояние

### Что работает
- Авторизация (email/password)
- Создание/управление играми
- Базовый лист персонажа D&D 2024
- Shared items (карты, заметки)
- Knowledge base (базовая структура)

### Что в процессе
- Улучшение листа персонажа
- Компендиум

### Известные проблемы
- GM-only items фильтруются на клиенте (не безопасно)
- Нет линтера
- Нет тестов

### Архитектура данных персонажей
Данные персонажей разделены на публичные и приватные на уровне Firestore:
- **Публичные** (`characters/{id}`) — видны всем игрокам: name, avatar, publicDescription
- **Приватные** (`characters/{id}/private/sheet`) — только owner + GM: stats, spells, inventory и т.д.
- При клике на чужого персонажа — модалка с публичной инфой, на своего — полный лист

## Окружение разработки

```bash
# Установка зависимостей
npm install

# Запуск dev сервера + эмуляторов
npm run dev        # в одном терминале
npm run emulators  # в другом терминале

# Деплой
npm run deploy:staging
```

## Полезные ссылки

- [SRD 5.2.1](https://www.dndbeyond.com/resources/1781-systems-reference-document-srd) — официальный D&D 2024 SRD
- [Firebase Console](https://console.firebase.google.com/) — управление Firebase
- [Firestore Emulator UI](http://localhost:4000) — локальная БД (при запущенных эмуляторах)

## Предпочтения владельца

- Не переусложнять решения
- Предпочитает понятный код сложному "оптимальному"
- Готов к итеративным улучшениям
- Основной язык общения — русский
